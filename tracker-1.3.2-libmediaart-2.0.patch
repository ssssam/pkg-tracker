From a87a0319b170276284edaeb6e61bd1c0fe41a834 Mon Sep 17 00:00:00 2001
From: Yanko Kaneti <yaneti@declera.com>
Date: Tue, 20 Jan 2015 17:35:12 +0200
Subject: Mechanically adjust for libmediaart-2.0

https://bugzilla.gnome.org/show_bug.cgi?id=743250

diff --git a/configure.ac b/configure.ac
index ec8b150..017b4cf 100644
--- a/configure.ac
+++ b/configure.ac
@@ -231,7 +231,7 @@ NETWORK_MANAGER_REQUIRED=0.8
 GSTREAMER_REQUIRED=0.10.31
 GUPNP_DLNA_REQUIRED=0.9.4
 LIBPNG_REQUIRED=0.89
-LIBMEDIAART_REQUIRED=0.5.0
+LIBMEDIAART_REQUIRED=1.9.0
 
 # 3.6.11 for sqlite_backup API
 # 3.6.16 to fix test failures
@@ -1107,7 +1107,7 @@ AC_ARG_ENABLE(libmediaart,
 
 if test "x$enable_libmediaart" != "xno" ; then
    PKG_CHECK_MODULES(LIBMEDIAART,
-                     [libmediaart-1.0 >= $LIBMEDIAART_REQUIRED],
+                     [libmediaart-2.0 >= $LIBMEDIAART_REQUIRED],
                      [have_libmediaart=yes],
                      [have_libmediaart=no])
 
@@ -1124,7 +1124,7 @@ if test "x$enable_libmediaart" != "xno" ; then
    TRACKER_MINER_FS_LIBS="$TRACKER_MINER_FS_LIBS $LIBMEDIAART_LIBS"
 
    # Used for .pc file...
-   LIBTRACKER_MINER_PC_REQUIRES="libmediaart-1.0"
+   LIBTRACKER_MINER_PC_REQUIRES="libmediaart-2.0"
    AC_SUBST(LIBTRACKER_MINER_PC_REQUIRES)
 
    if test "x$have_libmediaart" = "xyes"; then
diff --git a/src/libtracker-miner/tracker-media-art.c b/src/libtracker-miner/tracker-media-art.c
index c0559e9..cbba55d 100644
--- a/src/libtracker-miner/tracker-media-art.c
+++ b/src/libtracker-miner/tracker-media-art.c
@@ -96,16 +96,16 @@ on_query_finished (GObject      *source_object,
 		/* The get_path API does stripping itself */
 		media_art_get_path (artist,
 		                    album,
-		                    "album", NULL,
-		                    &target, NULL);
+		                    "album",
+		                    &target);
 
 		g_hash_table_replace (table, target, target);
 
 		/* Also add the file to which the symlinks are made */
 		media_art_get_path (NULL,
 		                    album,
-		                    "album", NULL,
-		                    &album_path, NULL);
+		                    "album",
+		                    &album_path);
 
 
 		g_hash_table_replace (table, album_path, album_path);
diff --git a/src/tracker-extract/tracker-extract-gstreamer.c b/src/tracker-extract/tracker-extract-gstreamer.c
index 7d52e0b..ef56d88 100644
--- a/src/tracker-extract/tracker-extract-gstreamer.c
+++ b/src/tracker-extract/tracker-extract-gstreamer.c
@@ -1661,6 +1661,7 @@ tracker_extract_gstreamer (const gchar          *uri,
 				                                    extractor->media_art_buffer_mime,
 				                                    extractor->media_art_artist,
 				                                    extractor->media_art_title,
+				                                    NULL,
 				                                    &error);
 			} else {
 				success = media_art_process_file (media_art_process,
@@ -1669,6 +1670,7 @@ tracker_extract_gstreamer (const gchar          *uri,
 				                                  tracker_extract_info_get_file (info),
 				                                  extractor->media_art_artist,
 				                                  extractor->media_art_title,
+				                                  NULL,
 				                                  &error);
 			}
 
diff --git a/src/tracker-extract/tracker-extract-mp3.c b/src/tracker-extract/tracker-extract-mp3.c
index f2ef306..b93e4f4 100644
--- a/src/tracker-extract/tracker-extract-mp3.c
+++ b/src/tracker-extract/tracker-extract-mp3.c
@@ -2675,6 +2675,7 @@ tracker_extract_get_metadata (TrackerExtractInfo *info)
 			                                    md.media_art_mime,
 			                                    md.performer,
 			                                    md.title,
+			                                    NULL,
 			                                    &error);
 		} else {
 			success = media_art_process_file (media_art_process,
@@ -2683,6 +2684,7 @@ tracker_extract_get_metadata (TrackerExtractInfo *info)
 			                                  file,
 			                                  md.performer,
 			                                  md.title,
+			                                  NULL,
 			                                  &error);
 		}
 
diff --git a/src/tracker-extract/tracker-extract-vorbis.c b/src/tracker-extract/tracker-extract-vorbis.c
index e619650..91c383c 100644
--- a/src/tracker-extract/tracker-extract-vorbis.c
+++ b/src/tracker-extract/tracker-extract-vorbis.c
@@ -527,6 +527,7 @@ tracker_extract_get_metadata (TrackerExtractInfo *info)
 		                                  file,
 		                                  vd.album_artist ? vd.album_artist : vd.artist,
 		                                  vd.album,
+		                                  NULL,
 		                                  &error);
 
 		if (!success || error) {
-- 
cgit v0.10.1

